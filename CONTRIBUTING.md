# How to Contribute

First of all, thank you for putting in the time and effort to contribute to this project!

Before submitting a PR, check open issues and PRs to see if there is already someone working on the
problem.

This project relies heavily on automation for code consistency.
linearmoney is a small project without the resources to manually review things like code style, so
PRs that fail any CI checks will not be accepted, even if it's only the linter.

## Workflow

linearmoney uses [Hatch](https://hatch.pypa.io/latest/) for its tooling, so
you'll need to [install](https://hatch.pypa.io/latest/install/#pipx) it if
you haven't already.

Once you have hatch installed, you can checkout a local branch on your fork and freely
develop on the source code. Hatch takes care of virtualenv setup, so to experiment with
the project in the REPL, you can just use `hatch shell` in the project root directory.

You can also run the test suite with hatch without entering a virtualenv: `hatch run test:suite`.

The test suite is very thorough, and it should catch most, if not all, regressions that your changes introduce.
It's also very fast, generally less than 3 seconds to run the entire suite on a Ryzen 5 2600, so
running the full test suite regularly while developing is an efficient workflow.

Before submitting your changes as a PR, run the full automation suite locally with `hatch run all`.
This includes formatting (black), linting (flake8), and type checking (mypy).
Fix any local failures before pushing your changes.

## Documentation Changes

The automation suite does not build the documentation by default. This is to prevent extraneous
diffs from cluttering git status and history when nothing was actually changed.

If you are contributing documentation changes or you made a change to a docstring as part
of your code changes, you can verify the changes locally with:

```bash
hatch run docs:build
hatch run docs:serve
```

This will serve the built documentation site at `localhost:8000`.

Please do not commit the built documentation even if making documentation-specific changes.

The changes to the markdown or source files are what we want to see in the diff for documentation
updates. The documentation site will be regenerated by the maintainer when a release is prepared
or at their discretion if a correction to the current version needs to be published.

## Testing Guidelines

Test coverage is not enforced by CI or review policy, but you are strongly encouraged to add
test cases that validate your changes in the same PR. Ideally, the tests will be added with a
separate commit from the source changes to make red-green validation easier for the reviewer.

In particular, bug fixes will not be merged without a regression case to prevent reintroduction of the bug.

We want this project to be friendly to new contributors, so if you are new to
testing, feel free to ask for help from the current maintainer with an @-mention
in the PR description. They will assist you with a detailed review of your test cases, or if needed,
they can write the tests for you. However, they may request changes to the source implementation
if the code is not written in a way that is easily testable. Code that is easily testable is usually easier
to change later as well, so this is an opportunity to improve the design of the changes before
merge.

## Updating CLDR Data

If a new version of the CLDR data has been released and we have decided to include
it, then we can update it with the following steps:

1. Pull the new version of the CLDR JSON data from the upstream https://github.com/unicode-org/cldr-json repo.
2. Run `hatch run cldr:build` to process the new data and update the linearmoney resource files.
3. Run `hatch run test:suite` to verify that there are no problems with the newly generated data.
4. If tests failed due to a change in the data causing the expected formatting or rounding results to change, update the test cases with the new expectations based on the updated data. If the test failed because the expected structure of the data changed or because of some error in the build, then the tests should not be updated and the data processing script needs to be debugged.
5. Once source tests are passing, copy the resource files to the test file locations in the `tests` directory. E.g. `src/linearmoney/locales.json` -> `tests/cldr/locales.json`. These files are used to test changes to the cldr data processing script itself.
6. Run `hatch run cldr:test` to ensure the test resource files were copied correctly.
7. Commit and push your changes.

## Creating a Release

If you are the current maintainer of linearmoney, you can follow these steps to create
a new package release:

1. Merge any changes that need to be included in the release into the main branch.
2. Rebuild the documentation with `hatch run docs:build`.
3. Run `hatch run all` locally and ensure there are no issues.
4. Bump the VERSION in `src/linearmoney/__init__.py`.
5. Build the package locally and push to test.pypi.org.
6. Run `hatch run test:prod` to check that the published test package installs and runs correctly.
7. Publish the package to the public pypi registry.
8. Push your changes to the main branch of GH.
9. In the web UI, create a new release on the main branch from your new commit. Use the version as the tag. E.g. v1.0.1

Semantic versioning should be followed for all source code changes. Additionally, 
if the CLDR data version has been updated, then this constitutes a minor version update.
The reasoning behind this is that it doesn't change the interface of the library in any
way, but it can change the way currency information is displayed to users, so it is
not a breaking change, but it could cause problems for some use-cases. It should be
made very clear in the release notes that these changes are included in the release.

## Note on AI Generated Contributions

Please do not submit a PR that was generated by an LLM. Many people may
find LLMs very helpful for drafting their PR
descriptions or for assistance with solving some problems in code, and these
are completely valid and acceptable uses of AI. Using an AI coding
assistant or an LLM as part of your workflow is fine, but the maintainer
doesn't have the time to
review code that was generated *entirely* by an AI.

It can be difficult to tell
the difference between code generated by an AI and code that was written
by a developer who is unfamiliar with the language or the project, and it
takes time and effort to contribute to an open source project, so we will
give the benefit of the
doubt and try to help you improve the code if your contribution does not
meet the quality standards of the project. We ask that you
give the same respect of our time and effort and do not submit completely
AI-generated code. Thank you!

## Community Interactions

This project does not yet have a Code of Conduct, but interactions with
other contributors and users of the project should remain professional.

In general, anything that would not be appropriate when dealing with a
coworker or client should be considered inappropriate here as well.

